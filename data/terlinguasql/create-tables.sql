use Terlingua;

IF NOT EXISTS (SELECT * FROM SYS.SCHEMAS WHERE NAME = N'TERLINGUA')
	EXEC('CREATE SCHEMA [TERLINGUA] AUTHORIZATION [DBO]');
go

IF (OBJECT_ID('TERLINGUA.CHILD') IS NOT NULL)
	BEGIN 
	DROP TABLE TERLINGUA.CHILD;
END

IF (OBJECT_ID('TERLINGUA.ITEM') IS NOT NULL)
	BEGIN 
	DROP TABLE TERLINGUA.ITEM;
END

IF (OBJECT_ID('TERLINGUA.TERRITORY') IS NOT NULL)
	BEGIN 
	DROP TABLE TERLINGUA.TERRITORY;
END

IF (OBJECT_ID('TERLINGUA.CATEGORY') IS NOT NULL)
	BEGIN 
	DROP TABLE TERLINGUA.CATEGORY;
END

IF (OBJECT_ID('TERLINGUA.PERSON') IS NOT NULL)
	BEGIN 
	DROP TABLE TERLINGUA.PERSON;
END

CREATE TABLE TERLINGUA.PERSON
(
	ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
	CORPORATE_IDENTIFIER NVARCHAR(255) NOT NULL UNIQUE,
	ROW_VERSION ROWVERSION NOT NULL
);

CREATE TABLE TERLINGUA.CATEGORY
(
	ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
	TITLE NVARCHAR(255) NOT NULL UNIQUE,
	ROW_VERSION ROWVERSION NOT NULL
);

CREATE TABLE TERLINGUA.TERRITORY
(
	ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
	CODE NVARCHAR(255) NOT NULL UNIQUE,
	TITLE NVARCHAR(255) NOT NULL,
	CONTACT INT NULL
		CONSTRAINT FK_TERRITORY_PERSON
		REFERENCES TERLINGUA.PERSON(ID),
	ROW_VERSION ROWVERSION NOT NULL
);

CREATE TABLE TERLINGUA.ITEM
(
	ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
	ITEM_ID INT NOT NULL,
	PROJECT_ID NVARCHAR(255) NOT NULL,
	PROJECT_MANAGER INT NOT NULL 
		CONSTRAINT FK_ITEM_PERSON_PROJECT_MANAGER 
		REFERENCES TERLINGUA.PERSON(ID),
	PROJECT_MANAGER_NOTE NVARCHAR(255) NULL,
	ACCESS_PLANNER INT NOT NULL
		CONSTRAINT FK_ITEM_PERSON 
		REFERENCES TERLINGUA.PERSON(ID),
	ACCESS_PLANNER_NOTE NVARCHAR(MAX) NULL,
	SWITCHED_PROJECT_MANAGER INT NOT NULL
		CONSTRAINT FK_ITEM_PERSON_SWITCHED_PROJECT_MANAGER
		REFERENCES TERLINGUA.PERSON(ID),
	SWITCHED_PROJECT_MANAGER_NOTE NVARCHAR(MAX) NOT NULL,
	SWITCHED_PLANNER INT NOT NULL
		CONSTRAINT FK_ITEM_PERSON_SWITCHED_PLANNER 
		REFERENCES TERLINGUA.PERSON(ID),
	SWITCHED_PLANNER_NOTE NVARCHAR(MAX) NOT NULL,
	PARENT_PROJECT_ID NVARCHAR(255) NULL,
	CATEGORY INT NOT NULL
		CONSTRAINT FK_ITEM_CATEGORY
		REFERENCES TERLINGUA.CATEGORY(ID),
	MONTHLY_RECURRING_COST_SAVING DECIMAL(19,4),
	MONTHLY_RECURRING_REVENUE DECIMAL(19,4),
	NOTE NVARCHAR(MAX) NULL,
	CREATED_BY INT NOT NULL
		CONSTRAINT FK_ITEM_PERSON_CREATED_BY
		REFERENCES TERLINGUA.PERSON(ID),
	CREATED_DATE DATETIME2(7) NOT NULL,
	ROW_VERSION ROWVERSION NOT NULL
);

CREATE TABLE TERLINGUA.CHILD
(
	ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
	CHILD_ID INT NOT NULL,
	PARENT INT NOT NULL 
		CONSTRAINT FK_CHILD_ITEM
		REFERENCES TERLINGUA.ITEM(ID),
	NOTE NVARCHAR(MAX) NULL,
	CREATED_BY INT NOT NULL
		CONSTRAINT FK_CHILD_PERSON_CREATED_BY
		REFERENCES TERLINGUA.PERSON(ID),
	CREATED_DATE DATETIME2(7) NOT NULL,
	ROW_VERSION ROWVERSION NOT NULL
);